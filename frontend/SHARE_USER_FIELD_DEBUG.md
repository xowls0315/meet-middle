# ê³µìœ  API user í•„ë“œ ë””ë²„ê¹… ê°€ì´ë“œ

## ğŸ” ë¬¸ì œ ìƒí™©

ê³µìœ  í˜ì´ì§€ì—ì„œ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ê³µìœ í•œ ë§í¬ë¥¼ ì—´ì—ˆì„ ë•Œ, `user` í•„ë“œê°€ `undefined`ë¡œ ë‚˜ì˜¤ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

ì½˜ì†” ë¡œê·¸:

```
ğŸ‘¤ ì‚¬ìš©ì ì •ë³´: undefined
```

## ğŸ“‹ ì›ì¸ ë¶„ì„

### 1. í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œ í™•ì¸

í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œëŠ” ì˜¬ë°”ë¥´ê²Œ ì‘ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

```typescript
// app/share/[id]/page.tsx
{
  shareData.user?.name ? (
    <p className="text-slate-600">
      <span className="font-bold">{shareData.user.name}</span> ë‹˜ì´ ê³µìœ í•œ ë§Œë‚¨ ì¥ì†Œ ì¶”ì²œì…ë‹ˆë‹¤
    </p>
  ) : (
    <p className="text-slate-600">ë‹¤ë¥¸ ì‚¬ëŒì´ ê³µìœ í•œ ë§Œë‚¨ ì¥ì†Œ ì¶”ì²œì…ë‹ˆë‹¤</p>
  );
}
```

### 2. íƒ€ì… ì •ì˜ í™•ì¸

```typescript
// types/index.ts
export interface ShareData {
  // ... ê¸°íƒ€ í•„ë“œë“¤
  user?: {
    name: string;
  };
}
```

íƒ€ì… ì •ì˜ë„ ì˜¬ë°”ë¦…ë‹ˆë‹¤.

### 3. API í˜¸ì¶œ í™•ì¸

```typescript
// lib/api/share.ts
export async function getShare(shareId: string): Promise<ShareData> {
  const response = await apiClient.get<ShareData>(`/share/${shareId}`);
  return response.data;
}
```

API í˜¸ì¶œ ì½”ë“œë„ ì •ìƒì…ë‹ˆë‹¤.

## ğŸ› ë¬¸ì œ ì›ì¸

**ë°±ì—”ë“œì—ì„œ `user` ì •ë³´ë¥¼ ë°˜í™˜í•˜ì§€ ì•Šê³  ìˆìŠµë‹ˆë‹¤.**

### ê°€ëŠ¥í•œ ì›ì¸ë“¤:

1. **ê³µìœ  ìƒì„± ì‹œ ì‚¬ìš©ì ì •ë³´ ë¯¸ì €ì¥**

   - `POST /api/share`ì—ì„œ JWT í† í°ì„ ì½ì–´ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥í•˜ì§€ ì•ŠìŒ
   - ë¡œê·¸ì¸ ìƒíƒœì™€ ê´€ê³„ì—†ì´ ê³µìœ ë¥¼ ìƒì„±í•  ìˆ˜ ìˆì§€ë§Œ, ë¡œê·¸ì¸í•œ ê²½ìš° ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥í•´ì•¼ í•¨

2. **ê³µìœ  ì¡°íšŒ ì‹œ ì‚¬ìš©ì ì •ë³´ ë¯¸ë°˜í™˜**

   - `GET /api/share/:id`ì—ì„œ ì €ì¥ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ì‘ë‹µì— í¬í•¨í•˜ì§€ ì•ŠìŒ
   - ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë˜ì–´ ìˆì–´ë„ ì‘ë‹µì—ì„œ ëˆ„ë½ë¨

3. **ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ ë¯¸ì ìš©**
   - ê³µìœ  ìƒì„± APIì— ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ê°€ ì—†ì–´ì„œ `req.user`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ
   - ì„ íƒì  ì¸ì¦(optional auth)ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•  ìˆ˜ ìˆìŒ

## âœ… ë°±ì—”ë“œì—ì„œ í™•ì¸í•´ì•¼ í•  ì‚¬í•­

### 1. ê³µìœ  ìƒì„± API (`POST /api/share`)

```typescript
// ë°±ì—”ë“œ ì˜ˆì‹œ ì½”ë“œ (NestJS)
@Post('/share')
async createShare(@Body() data: ShareRequest, @Req() req?: Request) {
  // ì„ íƒì  ì¸ì¦: ë¡œê·¸ì¸í•œ ê²½ìš°ì—ë§Œ ì‚¬ìš©ì ì •ë³´ ì €ì¥
  const userId = req?.user?.id; // JWT í† í°ì—ì„œ ì‚¬ìš©ì ID ì¶”ì¶œ

  const share = await this.shareService.create({
    ...data,
    userId: userId || null, // ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš° null
  });

  return { shareId: share.id, url: `...` };
}
```

**í™•ì¸ ì‚¬í•­:**

- [ ] JWT í† í°ì´ ìˆìœ¼ë©´ `req.user`ì—ì„œ ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ
- [ ] ê³µìœ  ë°ì´í„° ì €ì¥ ì‹œ `userId` ë˜ëŠ” `userName` í•„ë“œ ì €ì¥
- [ ] ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš°ì—ë„ ê³µìœ  ìƒì„± ê°€ëŠ¥ (ì„ íƒì  ì¸ì¦)

### 2. ê³µìœ  ì¡°íšŒ API (`GET /api/share/:id`)

```typescript
// ë°±ì—”ë“œ ì˜ˆì‹œ ì½”ë“œ (NestJS)
@Get('/share/:id')
async getShare(@Param('id') id: string) {
  const share = await this.shareService.findById(id);

  // ì €ì¥ëœ ì‚¬ìš©ì ì •ë³´ê°€ ìˆìœ¼ë©´ í¬í•¨
  const response = {
    anchor: share.anchor,
    final: share.final,
    candidates: share.candidates,
    participants: share.participants,
    // ì‚¬ìš©ì ì •ë³´ ì¶”ê°€
    ...(share.user && {
      user: {
        name: share.user.name, // ì‚¬ìš©ì ì´ë¦„ë§Œ ë°˜í™˜ (ê°œì¸ì •ë³´ ìµœì†Œí™”)
      },
    }),
  };

  return response;
}
```

**í™•ì¸ ì‚¬í•­:**

- [ ] ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê³µìœ  ë°ì´í„° ì¡°íšŒ ì‹œ ì‚¬ìš©ì ì •ë³´ë„ í•¨ê»˜ ì¡°íšŒ
- [ ] ì‘ë‹µì— `user` í•„ë“œ í¬í•¨ (ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ê³µìœ í•œ ê²½ìš°)
- [ ] `user` í•„ë“œê°€ ì—†ìœ¼ë©´ ì‘ë‹µì—ì„œ ìƒëµ (ê²ŒìŠ¤íŠ¸ ê³µìœ )

### 3. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

```typescript
// Share ì—”í‹°í‹° ì˜ˆì‹œ
@Entity()
export class Share {
  // ... ê¸°ì¡´ í•„ë“œë“¤

  @ManyToOne(() => User, { nullable: true })
  user?: User; // ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ê³µìœ í•œ ê²½ìš°

  // ë˜ëŠ” ì§ì ‘ ì €ì¥
  @Column({ nullable: true })
  userName?: string; // ì‚¬ìš©ì ì´ë¦„ë§Œ ì €ì¥
}
```

**í™•ì¸ ì‚¬í•­:**

- [ ] Share í…Œì´ë¸”ì— `userId` ë˜ëŠ” `userName` í•„ë“œ ì¡´ì¬
- [ ] í•„ë“œê°€ `nullable: true`ë¡œ ì„¤ì •ë˜ì–´ ìˆìŒ (ê²ŒìŠ¤íŠ¸ ê³µìœ  í—ˆìš©)

## ğŸ”§ ë””ë²„ê¹… ë°©ë²•

### 1. í”„ë¡ íŠ¸ì—”ë“œ ì½˜ì†” ë¡œê·¸ í™•ì¸

ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ ì½˜ì†”ì—ì„œ ë‹¤ìŒ ë¡œê·¸ë¥¼ í™•ì¸:

```
ğŸ“¦ ê³µìœ  ë°ì´í„° ì‘ë‹µ (ì „ì²´): {...}
ğŸ‘¤ ì‚¬ìš©ì ì •ë³´: undefined
ğŸ” user í•„ë“œ ì¡´ì¬ ì—¬ë¶€: false
ğŸ” user í•„ë“œ ê°’: undefined
```

### 2. ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ ì‹¤ì œ ì‘ë‹µ í™•ì¸

1. ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ â†’ Network íƒ­
2. `GET /api/share/:id` ìš”ì²­ í´ë¦­
3. Response íƒ­ì—ì„œ ì‹¤ì œ ì‘ë‹µ ë°ì´í„° í™•ì¸
4. `user` í•„ë“œê°€ ìˆëŠ”ì§€ í™•ì¸

**ì˜ˆìƒ ì‘ë‹µ (ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ê³µìœ í•œ ê²½ìš°):**

```json
{
  "anchor": {...},
  "final": {...},
  "candidates": [...],
  "participants": [...],
  "user": {
    "name": "í™©íƒœì§„"
  }
}
```

**ì˜ˆìƒ ì‘ë‹µ (ê²ŒìŠ¤íŠ¸ ê³µìœ ):**

```json
{
  "anchor": {...},
  "final": {...},
  "candidates": [...],
  "participants": [...]
  // user í•„ë“œ ì—†ìŒ
}
```

### 3. ë°±ì—”ë“œ ë¡œê·¸ í™•ì¸

ë°±ì—”ë“œ ì„œë²„ ë¡œê·¸ì—ì„œ:

- ê³µìœ  ìƒì„± ì‹œ ì‚¬ìš©ì ì •ë³´ê°€ ì €ì¥ë˜ëŠ”ì§€ í™•ì¸
- ê³µìœ  ì¡°íšŒ ì‹œ ì‚¬ìš©ì ì •ë³´ê°€ í¬í•¨ë˜ëŠ”ì§€ í™•ì¸

## ğŸ¯ í•´ê²° ë°©ë²•

### ë°±ì—”ë“œ ê°œë°œìê°€ í•´ì•¼ í•  ì‘ì—…

1. **ê³µìœ  ìƒì„± ì‹œ ì‚¬ìš©ì ì •ë³´ ì €ì¥**

   ```typescript
   // ì„ íƒì  ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ ì‚¬ìš©
   @UseGuards(OptionalJwtAuthGuard)
   @Post('/share')
   async createShare(@Body() data: ShareRequest, @Req() req) {
     const userId = req.user?.id; // ë¡œê·¸ì¸í•œ ê²½ìš°ì—ë§Œ ì¡´ì¬

     const share = await this.shareService.create({
       ...data,
       userId, // null ë˜ëŠ” ì‚¬ìš©ì ID
     });
   }
   ```

2. **ê³µìœ  ì¡°íšŒ ì‹œ ì‚¬ìš©ì ì •ë³´ ë°˜í™˜**

   ```typescript
   @Get('/share/:id')
   async getShare(@Param('id') id: string) {
     const share = await this.shareService.findById(id);

     return {
       ...share,
       ...(share.user && {
         user: { name: share.user.name },
       }),
     };
   }
   ```

3. **ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜**
   - ê¸°ì¡´ Share ë ˆì½”ë“œì—ëŠ” `user` í•„ë“œê°€ ì—†ì„ ìˆ˜ ìˆìŒ
   - ìƒˆë¡œ ìƒì„±ë˜ëŠ” ê³µìœ ë¶€í„° `user` ì •ë³´ ì €ì¥

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°±ì—”ë“œ

- [ ] `POST /api/share`ì—ì„œ JWT í† í°ì´ ìˆìœ¼ë©´ ì‚¬ìš©ì ì •ë³´ ì €ì¥
- [ ] `GET /api/share/:id`ì—ì„œ ì €ì¥ëœ ì‚¬ìš©ì ì •ë³´ ë°˜í™˜
- [ ] ë°ì´í„°ë² ì´ìŠ¤ì— `userId` ë˜ëŠ” `userName` í•„ë“œ ì¶”ê°€
- [ ] ì„ íƒì  ì¸ì¦(Optional Auth) ë¯¸ë“¤ì›¨ì–´ êµ¬í˜„
- [ ] ê¸°ì¡´ ê³µìœ  ë°ì´í„° í˜¸í™˜ì„± ìœ ì§€ (user í•„ë“œ ì—†ì–´ë„ ë™ì‘)

### í”„ë¡ íŠ¸ì—”ë“œ

- [x] íƒ€ì… ì •ì˜ì— `user?: { name: string }` ì¶”ê°€ âœ…
- [x] ì¡°ê±´ë¶€ ë Œë”ë§ ë¡œì§ êµ¬í˜„ âœ…
- [x] ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€ âœ…

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:** 2025ë…„ 1ì›”
