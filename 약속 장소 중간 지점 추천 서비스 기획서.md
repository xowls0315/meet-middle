# A–Z 기획서: 약속 장소 중간지점 추천 서비스 (2~4명, 자동완성, 랜드마크)

프론트엔드: localhost:3000, 백엔드: localhost: 3001

# `프론트엔드(Next.js) A–Z 할 일`

## A. App Router 구조 잡기

- 라우트: `/`(메인), `/share/[id]`(공유), `/history`(로그인), `/favorites`(로그인)
- 레이아웃: Header(로그인 버튼/프로필) + 메인(입력/결과/지도)

## B. Brand/UX 톤 정하기

- 서비스 이름/한 줄 설명(“2~4명 출발지 입력 → 만남 랜드마크 추천”)
- “완전 무료 운영”이므로 **자동완성 호출 절약 정책**을 UI에 자연스럽게 녹이기

## C. Count(2~4명) UI

- 2/3/4 선택 토글
- 선택 인원 변경 시 입력칸 동기화(추가/삭제)
- 라벨 고정(A,B,C,D)

## D. Data Model(프론트 상태 설계)

- `participants: [{label, query, selectedPlace}]`
- `result: { anchor, final, candidates, used }`
- `shareUrl`, `loading`, `error`
- 로그인 상태: `user`, `accessToken`(또는 쿠키 기반)

## E. Editable 입력 UX

- 입력 변경 시 `selectedPlace` 초기화(중요)
- 선택 완료 표시(체크/배지)

## F. Fetch 레이어(클라이언트 API 래퍼)

- `GET /api/search/suggest?q=...`
- `POST /api/recommend`
- `POST /api/share` + `GET /api/share/:id`
- `GET/POST/DELETE /api/favorites`
- `GET/POST/DELETE /api/meetings`(기록)

## G. Guest/Logged Mode 분기 UI

- 게스트: 추천/공유 OK, 저장 버튼 숨김 또는 “로그인하면 저장 가능” 안내
- 로그인: “기록 저장 / 즐겨찾기” 버튼 활성화

## H. Hint(쿼터 절약) UX 룰 적용

- 자동완성: 최소 2~3글자, 디바운스 500ms
- 선택 후에는 재검색 요청 금지
- “검색” 버튼 눌렀을 때만 호출(선택 옵션) → 호출 더 줄어듦

## I. Item Suggest List(자동완성 리스트)

- 최대 7~10개 표시
- 키보드 선택(↑↓/Enter) 지원하면 완성도↑
- 목록에서 선택하면 좌표 확정

## J. Just-in-time Validation

- 2~4명 모두 `selectedPlace` 있어야 “추천받기” 활성화
- 부족하면 안내 토스트

## K. Kakao Map JS SDK 탑재

- 지도 로드/초기화
- 마커 레이어 설계(참가자/anchor/final/candidates)

## L. Layered Markers(마커)

- 참가자 마커 A~D
- anchor 마커(작게)
- final 랜드마크 마커(강조)
- candidates 마커(옵션: 리스트 선택 시 강조)

## M. Map ↔ List 동기화

- 후보 리스트 클릭 → 지도 중심 이동 + 마커 강조
- 마커 클릭 → 상세 카드 열기(우측 패널/모달)

## N. Next Step UI(폴백 단계 표시)

- 백엔드가 `used`(카테고리/반경)를 내려주면
  “지하철역→문화시설→공공기관→관광명소 순으로 검색” 안내 + 실제 사용된 값 표시

## O. Output Card(결과 카드)

- 최종 추천 카드: 이름/주소/거리 + “카카오맵에서 보기” 링크
- 후보 리스트: top 5~10

## P. Persist UX(로그인 시 저장/즐겨찾기)

- “이번 결과 저장” 버튼 → meetings 저장
- “즐겨찾기 추가” 버튼 → favorites 저장
  (final만 즐겨찾기, 또는 후보도 즐겨찾기 가능)

## Q. Quick Actions(유틸)

- 다시하기(입력 유지/전체 초기화 옵션)
- 현재 결과를 “공유”/“저장” 우선 버튼으로 노출

## R. Result Share UX(게스트/로그인 공통)

- “공유 링크 만들기” → shareId 생성 → URL 복사
- 카카오톡 공유는 1주일 MVP에서는 “URL 복사”만으로도 충분(무료/빠름)

## S. Share Page(`/share/[id]`)

- share 데이터 로딩 → 동일 결과 렌더(지도 포함)
- 개인정보 최소: 참가자 이름/원문 주소는 표시하지 말고 라벨만

## T. Token Handling(로그인 세션)

- 로그인 버튼 → 카카오 OAuth 시작
- 로그인 완료 후 상태 갱신(프로필 표시)
- 401 처리: 자동 로그아웃/재로그인 안내

## U. UI Error Handling

- 429/5xx: “요청이 많아 잠시 후 다시 시도” + 10~30초 쿨다운 UI
- 네트워크 오류 시 재시도 버튼(자동 재시도는 금지)

## V. Visual Polish(완성도)

- 로딩 스켈레톤
- 반응형(모바일에서 지도/패널 탭)
- 접근성(포커스/aria)

## W. Work with API Contract(협업)

- `Place`, `SuggestItem`, `RecommendResponse` 타입을 프론트에 고정
- API 변경 시 타입 먼저 수정 → UI 수정

## X. eXtra: 게스트 최근 기록(무료 최적화용)

- 로컬스토리지에 최근 3개 결과 저장(선택)
- 재조회는 외부 호출 없이 UI만 복원 가능

## Y. Your Deploy(배포)

- Vercel 배포
- 환경변수(지도 SDK 키) 세팅

## Z. Zero-cost Discipline(무료 유지)

- 자동완성 호출 “디바운스/최소글자/캐시” 철저
- 추천/공유는 “클릭 기반 1회”
- 무한 새로고침/자동 재요청 UI 금지

---

# `백엔드(Nest.js) A–Z 할 일`

## A. API 프로젝트 뼈대

- 모듈: `kakao-local`, `search`, `recommend`, `share`, `auth`, `meetings`, `favorites`

## B. Basic Config

- env: `KAKAO_REST_KEY`, `KAKAO_CLIENT_ID/SECRET`, `JWT_SECRET`, `DB_URL`
- CORS: 프론트 도메인만 허용

## C. Client Wrapper(카카오 로컬 호출 래퍼)

- axios/httpService로 공통 호출 함수
- 타임아웃/에러 표준화

## D. Data Store(무료 DB)

- 기록/즐겨찾기는 DB 필요(로그인 모드)
- 무료 플랜 Postgres(예: Neon/Supabase 등) 사용 가능
- ORM: Prisma(추천) or TypeORM

## E. Endpoint: Suggest(자동완성)

- `GET /api/search/suggest?q=...`
- `size=7~10` 제한
- q 길이 < 2면 빈 배열 반환
- 동일 q 캐시(TTL 60초)

## F. Filter(후보 정리)

- 중복 제거
- name/address/lat/lng/placeUrl 최소 필드로 정규화

## G. Guard: Rate Limit(무료 유지 핵심)

- suggest: IP당 분당 30회
- recommend: IP당 분당 10회
- share: IP당 분당 10회

## H. Handle 429/5xx(카카오/서버 에러)

- 카카오 429 → 사용자용 메시지 + 재시도 가이드
- 서버는 상세 로그(원인/요청키)만 남김

## I. Input Validation

- 참여 인원 2~4만 허용
- lat/lng 유효 범위 검증
- participants에 label A~D 강제

## J. Joint Logic: Anchor 계산

- 평균으로 anchor 계산
- anchor를 응답에 포함

## K. Key Logic: 랜드마크 폴백

- 우선순위:
  - SW8(지하철역)
  - CT1(문화시설)
  - PO3(공공기관)
  - AT4(관광명소)
- 반경 단계:
  - 2000 → 5000 → 10000 → 20000

## L. Landmark Search 구현

- 카테고리 검색 API를 `sort=distance`로 호출
- documents 1개 이상이면:
  - `final = documents[0]`
  - `candidates = documents.slice(0,10)`
  - `used={category,radius}` 반환

## M. Max Attempts(무한 호출 방지)

- 최악 호출 상한 설정(예: 4카테고리×4반경=16회)
- 상한 초과 전엔 거의 성공하지만, 안전장치로 필수

## N. Normalize Response(응답 통일)

- Place 표준 필드로 변환:
  - `placeId, name, address, lat, lng, placeUrl, distance`
- 프론트 타입과 1:1 매칭

## O. OAuth: 카카오 로그인

- `GET /api/auth/kakao`(리다이렉트 생성)
- `GET /api/auth/kakao/callback`(인가코드→토큰→유저정보→JWT 발급)
- 토큰 전달 방식: httpOnly 쿠키 추천(프론트 단순해짐)

## P. Profile Endpoint

- `GET /api/me`로 로그인 확인/프로필 반환

## Q. Quota-saving Cache(서버 캐시)

- suggest 캐시(60초)
- landmark 캐시(5분): `anchor+category+radius` 기준
- 동일 anchor 좌표가 반복되면 외부 호출이 크게 줄어듦

## R. Record: Meetings(기록)

- `POST /api/meetings` (final 선택 결과 저장)
- `GET /api/meetings` (최근순)
- `DELETE /api/meetings/:id` (선택)
- 저장 데이터 최소화(참가자 원문 주소 저장 X, 라벨/좌표만)

## S. Favorites(즐겨찾기)

- `POST /api/favorites` (placeId unique)
- `GET /api/favorites`
- `DELETE /api/favorites/:placeId`
- 중복 추가 방지 unique 인덱스

## T. Share(공유: 게스트/로그인 공통)

- `POST /api/share` : 결과 저장 → shareId 생성
- `GET /api/share/:id` : 결과 조회
- 공유 데이터는 개인정보 최소(라벨+좌표+final/candidates만)

## U. Unauthenticated Share 정책

- 게스트도 생성 가능
- 악용 방지:
  - rate limit
  - TTL 만료(예: 7일 후 자동 삭제) — 무료 운영에 유리

## V. Validation & Sanitization

- share 생성 요청에서 candidates 길이 제한(최대 10)
- 좌표 소수점 자리 제한(예: 6자리)로 데이터 표준화

## W. Write Tests(최소 테스트)

- 추천 로직 폴백 순서 테스트
- 2~4명 검증 테스트
- share 저장/조회 테스트

## X. eXpose Logs(운영 로그)

- 외부 호출 횟수/폴백 사용률/429 발생 로그
- “무료 운영 위험 신호” 체크

## Y. Your Deploy(배포)

- Render/Fly/Railway 무료 플랜 배포
- 슬립(첫 요청 느림) 안내(프론트에서 문구)

## Z. Zero-cost Discipline(무료 유지)

- 캐시 + rate limit은 “옵션”이 아니라 “필수”
- 자동완성 과다 호출 방지 없으면 무료 유지 어려움
